<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>cem - [Not?] Misissued Certificates</title>
	<meta name="author" content="Carl Mehner">
    
	<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAiNJREFUOI2Nks9LVFEcxT/3vjfm+KOZTDAnzUmxZtoUoqFhktAPhBbTrj9AJLBFhC1CSqZdCbaIgnYt3ES0DCvNgqhAiEqJJq0JBx1FR+nNOM5T37zbopkhwhk8q8vhnvO953uP6FIDAI3mXPxMYmrJo9K2pAC00iJzb6f3CzAGJHWgfrp//JE5H29FUVCcRXR4cv3ApeZbrhbPbR04tLG4dhSFRGBVBXxDVQHfJ0D7Xzh943WPGTE6lGWXxMbC7a4Wz10d/pkqhF0V8I0DL0ZEMEdnYlK8v/y0GTE6ALCVBIS+kyfn/HVpIcUWSgmhCQtQ+QxElxo4DsSAn1mytrvpQUn9nrld1eVGmb/yLWBttzQFuEN9Lx+Gro0+AY5lTa21zaaFx197k6GYB/gI5P0yoRSao8I5Hx58fxPwAxdn700E9PKihXRy05m9mH8HtpIH+048lQ6Zmhl4c18rK/rdcL29P3znXVD9XWBBgy1nnWtKOuQy8KwxeMoAIkDI6XX/cta5lwoZCCDhvdLaDWxkuOcAqVmjN/l95UhyZtWHrYS7rWYwb4QREVzLnrM9WB6ZaV7/sXoOYAWUu61maEfVLQQdSCNQACglo8OT5yvPNng756/mzM1oAoBUxDicU2oiTaZI34prdk+kZo2T2EqPjYYvx0bD+UcKbOHQ4vsu+F8BmyKTrxboiH9erFaWLYUUajutspXQXcVmaWPFFPABMP8AmgnNwTEAUpoAAAAASUVORK5CYII="> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="../cem.css" />
	
</head>

<body>

<header>
	<nav>
		<ul>
			<li><a href="../index.html"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAiNJREFUOI2Nks9LVFEcxT/3vjfm+KOZTDAnzUmxZtoUoqFhktAPhBbTrj9AJLBFhC1CSqZdCbaIgnYt3ES0DCvNgqhAiEqJJq0JBx1FR+nNOM5T37zbopkhwhk8q8vhnvO953uP6FIDAI3mXPxMYmrJo9K2pAC00iJzb6f3CzAGJHWgfrp//JE5H29FUVCcRXR4cv3ApeZbrhbPbR04tLG4dhSFRGBVBXxDVQHfJ0D7Xzh943WPGTE6lGWXxMbC7a4Wz10d/pkqhF0V8I0DL0ZEMEdnYlK8v/y0GTE6ALCVBIS+kyfn/HVpIcUWSgmhCQtQ+QxElxo4DsSAn1mytrvpQUn9nrld1eVGmb/yLWBttzQFuEN9Lx+Gro0+AY5lTa21zaaFx197k6GYB/gI5P0yoRSao8I5Hx58fxPwAxdn700E9PKihXRy05m9mH8HtpIH+048lQ6Zmhl4c18rK/rdcL29P3znXVD9XWBBgy1nnWtKOuQy8KwxeMoAIkDI6XX/cta5lwoZCCDhvdLaDWxkuOcAqVmjN/l95UhyZtWHrYS7rWYwb4QREVzLnrM9WB6ZaV7/sXoOYAWUu61maEfVLQQdSCNQACglo8OT5yvPNng756/mzM1oAoBUxDicU2oiTaZI34prdk+kZo2T2EqPjYYvx0bD+UcKbOHQ4vsu+F8BmyKTrxboiH9erFaWLYUUajutspXQXcVmaWPFFPABMP8AmgnNwTEAUpoAAAAASUVORK5CYII=" alt="cem.me" />
            </a></li>
			<li><a href="../all.html">index</a></li>
			<li><a href="../about.html">about</a></li>
			<li><a href="https://plus.google.com/u/0/115606090533118002214?prsrc=3&amp;rel=me" rel="publisher" target="_top" >
				<img src="https://ssl.gstatic.com/images/icons/gplus-16.png" alt="Google+" class="glogo" />
			</a></li>
		</ul>
	</nav>
    
<section id="topTitle">
  <p>&nbsp;</p><img class=mainLogo src="../logo.png" alt="cem.me"/><br /><h2>carl mehner's blog</h2>
</section>


</header>


<!-- -above is template for headers and style- -->


<article>
  <header>
	  <h1 class="title"><a href="#">[Not?] Misissued Certificates:</a></h1>
	  <time class="pubdate" datetime="2014-04-03">2014-04-03</time>
  <h4>or, how I was able to get over 2500 certificates for domains that I do not own</h4>

  </header>
  <p>Four years ago, in 2010, <a target="_blank" href="https://www.seifried.org/security/">Kurt Seifried</a> released <a target="_blank" href="http://www.linux-magazine.com/w3/issue/114/054-055_kurt.pdf">research</a> on how certificate authorities (CAs) validated hostnames in SSL certificate requests. <a href="https://afreak.ca/blog/author/ckeigher/" target="_blank">Colin Keigher</a> followed on by with an <a href="https://afreak.ca/blog/whos-letting-me-become-ssladmin/" target="_blank">actual implementation</a> of that research resulting in his finding of five email providers that allowed the registering of addresses, which effectively allowed him to garner certificates for those domains. Not to completely rehash their articles and research, here is a basic summary. SSL is the way trust disseminates between clients and servers (browsers and websites) over the Internet. The means for establishing this trust is the use of digital certificates which are signed (or vouched for) by a certificate authority (CA). Every browser comes with a vetted list of trusted CAs allowed to vouch for these end-entities (website) certificates. Persons using browsers trust that the browser manufacturers adequately validate the CAs on the trusted list they include (although knowledgeable individuals can edit that list themselves). In order for a browser to add a CA to their trust list, they must show that they follow some basic rules that include establishing any applicants that request a certificate are either "the Domain Name Registrant or has control over the FQDN" (fully qualified domain name [e.g. google.com.]). The CA Browser Forum (CAB Forum), a coalition of trust store owners and CAs, lays down these and other guidelines in their <a target="_blank" href="https://cabforum.org/baseline-requirements-documents/">Baseline Requirements.</a></p>
  <p>The research by Seifried and Keigher follows the line of how the CA establishes the control over the FQDN. They show that if you are able to get control of a set of special email addresses (e.g. admin, administrator, root, hostmaster, etc.) you are then able to get an SSL certificate for that domain. Popular purveyors of email addresses like Inbox.com, Excite, and Lavabit allowed Keigher to register one or more of these special email addresses, which he in turn used to demonstrate control of those domains to CAs, ultimately resulting with him receiving SSL certificates.</p>
  <p>I found that this avenue for procuring certificates still exists in at least two mail providers, which means that I was able to get upwards of 2,500 certificates for various domains that I do not own.</p>
  <img alt="lock" src="../art/qcert.png" />
  <p>A service in the UK, Freeola, holder of over 500 domains, neglected to place a filter on the allowed email addresses, allowing for the registration of user addresses capable of asserting control over those 500 domains. At this service, I had the ability to procure certificates for domains such as BritishIntellegence.co.uk and ninjas.co.uk.</p>
  <p>Freeola responded to my inquiries before publishing this article stating that they would not like to comment.</p>
  <p>One of the mail providers mentioned in Keigher's piece, Mail2World, still has not fixed the issue for their cache of more than 2,500 different available domains. There were a multitude of different addresses available that would suffice, however, I chose to procure the email address ssladmin@mail2world.com as well as hostmaster@mail2president.com. (I am not monitoring these so do not bother sending mail there...) I tried to first get admin, administrator, and webmaster, for those particular domains, unfortunately, others had already taken them. It is entirely possible that others are getting SSL certs (or just fun email addresses) this way as well. Similar to the attempt for correspondence by Keigher, Mail2World neglected to respond to my inquiries for comment.</p>
  <img alt="mail2president cert" src="../art/mail2pres.png" />
  <aside><p>As an aside, Mail2World has an option to select if you want to send your login credentials over the wire in plaintext or to select to use the 'secure' method (i.e. SSL). Of course the plaintext option is default because it is 'faster' (which may be true, if only by a few milliseconds). Nevertheless, there is good news, on their benefits page they say, "All our email servers are configured for ultimate technical security on the Internet". They must agree with the Computerworld article arguing that Google should let users choose to use GMail over plain http. On top of that, "When submitting a complaint, you are giving Mail2World express consent to log into your account to examine the problem." Are the passwords then stored in plain text? On the other hand, to give them the benefit of the doubt, they could reset the password and give the user a new one, or have a privileged account with sudo-like capabilities that can login as different users (but that would be more complex).</p></aside>
  <p>Seifried and Keigher predominantly presented this as a problem jointly between the CAs and site owners. I think the real issue is people do not understand what a SSL certificate stands for: Does it mean that the site owner or maintainer approved its issue? Does it just mean that someone loosely connected with that domain finagled a certificate out of the system? I believe that generally when technosavy people see a certificate, even if they take the time to think about it, they would tend to believe the former even though the latter may be true.</p>
  <h2>What has changed over the past four years? Is there a solution?</h2>
  <p>One option is to have the CA Browser Forum change what they consider 'control' of a domain and enforce that on CAs instead of a somewhat arbitrary list of names to demonstrate domain ownership, they could rely solely on the whois information, already well understood by everyone that has heard of whois. Another option, that preserves the privacy protection of private whois records, is to publicize a pared down mandatory list of addresses, or even a single, well-documented address for demonstrating domain ownership and advise email providers not to provision that address. Pending change in the CAB Forum, domain owners can set up mail sinks/traps for the list of addresses that prove domain ownership, this allows also for monitoring attempts of SSL registration done in this manner. However, this list can change on any CAs whim, and vary between different companies as well as change over time. Because of this, keeping up with the list of domain validation addresses in the end is likely infeasible.</p>
  <p>There is, however, a way to receive a notification and/or block registration attempts done via any other method. Site administrators are able to set Certificate Authority Authorization (CAA) records in their DNS. This record is for the CA to check at time of issuance if a particular domain has given it authorization to issue certificates. If a check fails, the CA will contact site administrator at a specified address to report the authorization attempt. At this time only a few CAs have shown public support for CAA in their issuance process. CAA support in servers has been coming along a little slow, but, one year (and a smidge) following the RFC publication there is some headway, BIND has coming in <a href="http://bind10.isc.org/ticket/2512" target="_blank">support in 10-1.2</a>, LDNS has <a href="http://git.nlnetlabs.nl/ldns/tree/Changelog?h=release-1.6.x" target="_blank">support in 1.6.17</a>, NSD has <a href="http://www.nlnetlabs.nl/projects/nsd/index.html#releases" target="_blank">support in 4.0.1</a>, yet PowerDNS still <a href="http://wiki.powerdns.com/trac/ticket/688" target="_blank">has none</a>. This is much better news since the <a href="https://cabforum.org/pipermail/public/2013-July/001921.html" target="_blank">status</a> back in July 2013.</p>
  <p>Complementarily, as a detective control to catch anything that slips by CAA's preventative control, Google has embarked on a journey with an experimental standard called <a target="_blank" href="http://tools.ietf.org/html/rfc6962">Certificate Transparency</a> (<a target="_blank" href="http://www.certificate-transparency.org/">CT</a>). This is a public log of all issued certificates that includes a method for clients to verify that any certificates they come across are included in a public log. This assures that any trusted certificates you come across are knowable or known by anyone, giving CAs faster reaction times for revoking misissued certificates. Site operators can check these public logs for any certificates for domains they own that they have not authorized and take any appropriate action with the issuing CA. Chrome currently shows via their certificate inspection dialogue if parameters proving that a publicly audited certificate is the base of the established connection. Chrome recently <a target="_blank" href="http://www.certificate-transparency.org/ev-ct-plan">broadcast</a> that they are making the use of CT mandatory for Extended Validation certificates after 1 Feb 2015. Finally, sites can take a stricter stance and actively deny unauthorized certificates by utilizing <a target="_blank" href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning#HTTP_pinning">HTTP Public Key Pinning</a> (HPKP) to explicitly state which certificates are valid for their domain.</p>
  <aside><p>You can read more about HPKP where I <a href="../20121201-cert-pinning.html">announced</a> the <a target="_blank" href="https://certpins.appspot.com/">tool</a> I wrote to create key pins, also, it is safe to use now that Google patched the bug I found that allowed an attacker to fill up your hard drive (if it did not crash your browser first) using my tool, <a href="hpkpwn.html">HPKPwn</a>.</p></aside>
  <p>There are still many ways that CAs can validate a subscriber, some are not explicitly spelled out and trigger only if you contact support. Site owners/sysadmins/infosec personnel must take steps to protect their site by using a multifaceted set of controls. In the four years after the original research, more tools have been made available for administrators to use including Certificate Authority Authorization and Certificate Transparency. Further, there are others available that should begin gaining popularity in time, including <a target="_blank" href="http://en.wikipedia.org/wiki/DNS-based_Authentication_of_Named_Entities">DANE</a> (certificate trust over DNSSEC) and HPKP's <a target="_blank" href="http://tools.ietf.org/html/draft-ietf-websec-key-pinning-11#section-2.1.3">report mode</a>. Report mode in HPKP gives a method for the user agent (i.e. the browser) to take in a set of expected certificates as well as a way to submit a report containing the actual certificates served if unexpected certificates are seen. It is unknown at this time when this functionality will be supported, I could not yet find any reference to it in the Chromium source. Until then, CAA, CT, and HPKP are all available now to help protect sites and their visitors.</p>


</article>



<footer>
	<cite>Copyright &copy; Carl Mehner</cite>
</footer>

</body>
</html>

