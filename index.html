<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>c em|me</title>
	<meta name="author" content="Carl Mehner">
    	<link rel="alternate" type="application/rss+xml" title="RSS"
      href="https://www.cem.me/cem.rss">
	<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAiNJREFUOI2Nks9LVFEcxT/3vjfm+KOZTDAnzUmxZtoUoqFhktAPhBbTrj9AJLBFhC1CSqZdCbaIgnYt3ES0DCvNgqhAiEqJJq0JBx1FR+nNOM5T37zbopkhwhk8q8vhnvO953uP6FIDAI3mXPxMYmrJo9K2pAC00iJzb6f3CzAGJHWgfrp//JE5H29FUVCcRXR4cv3ApeZbrhbPbR04tLG4dhSFRGBVBXxDVQHfJ0D7Xzh943WPGTE6lGWXxMbC7a4Wz10d/pkqhF0V8I0DL0ZEMEdnYlK8v/y0GTE6ALCVBIS+kyfn/HVpIcUWSgmhCQtQ+QxElxo4DsSAn1mytrvpQUn9nrld1eVGmb/yLWBttzQFuEN9Lx+Gro0+AY5lTa21zaaFx197k6GYB/gI5P0yoRSao8I5Hx58fxPwAxdn700E9PKihXRy05m9mH8HtpIH+048lQ6Zmhl4c18rK/rdcL29P3znXVD9XWBBgy1nnWtKOuQy8KwxeMoAIkDI6XX/cta5lwoZCCDhvdLaDWxkuOcAqVmjN/l95UhyZtWHrYS7rWYwb4QREVzLnrM9WB6ZaV7/sXoOYAWUu61maEfVLQQdSCNQACglo8OT5yvPNng756/mzM1oAoBUxDicU2oiTaZI34prdk+kZo2T2EqPjYYvx0bD+UcKbOHQ4vsu+F8BmyKTrxboiH9erFaWLYUUajutspXQXcVmaWPFFPABMP8AmgnNwTEAUpoAAAAASUVORK5CYII="> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="cem.css" />
    <script src="cem.js" ></script>	
    <meta name="theme-color" content="darkolivegreen" />
</head>

<body>

<header>
	<nav>
		<object type="image/svg+xml" data="art/navL.svg" id="navLeft"></object>
    		<object type="image/svg+xml" data="art/navR.svg" id="navRight"></object>
	</nav>
    
	<section id="topTitle">
		<p>&nbsp;</p>
		<a href="https://www.cem.me/index.html">
			<img class=mainLogo src="art/cem.svg" alt="cem.me"/>
		</a><br />
		<h2>carl mehner's blog</h2>
	</section>
</header>


<!-- -above is template for headers and style- -->

<article>
  <header>
	  <h1 class="title"><a href="20160108-keychain.html">OS X Keychain Key Export Authentication Bypass</a></h1>
	  <time class="pubdate" datetime="2016-01-08">2016-01-08</time>
  </header>

<p>
This vulnerability allows anyone, with log-on access to an OS X machine, the ability to export private keys from the system keystore of OS X. Normally, there are two ways to stop this, only system administrators would have access to use or export system keys and they can be made non-exportable for any user. However, for this vulnerability, those two mitigations matter not. Normally, one would need to authenticate as an administrator, but as you can see below, Apple’s authentication procedure does not error out properly. This means that if an administrator has deployed a certificate solely, meant for system use, anyone else now can use it for their own purposes. </p>
<p><b>Note:</b>I believe this is the same as CVE-2015-7058, however, I never recived official confirmation of that from Apple. It does seem the same, and appears to be fixed at this time.
</p>
<br />
<h3>Disclosure Timeline:</h3>
<ul>
<li>2015-03-12: Initial discovery</li>
<li>2015-03-13: Reported to Apple</li>
<li>2015-03-17: Apple responded they are investigating</li>
<li>2015-12-08: Update released</li>
<li>2015-12-10: Asked for confirmation that <a href="http://lists.apple.com/archives/security-announce/2015/Dec/msg00005.html">CVE-2015-7058</a> was the same vuln I reported - crickets.</li>
<li>2016-01-06: Public Disclosure</li>
</ul>

<h3>Technical Details &amp; Description</h3>

<h5>Affected Product Details:</h5>
<p>
OS X before 10.11.2<br />
Apple iOS before 9.2<br />
Apple tvOS before 9.1</p>

<h5>Security Risk:</h5>
<p>
A non-privileged user is able to export keys and certificate
 they should not have access to export. Additionally, they
 are able to deactivate the non-exportable flag on the key
 if it was originally imported with '-x'.</p>

<h5>How to recreate results / PoC:</h5>
<p><i>Prerequisites</i></p>
<p>
Either:<br />
 An asymmetric key exists in the system keystore and is
 marked as non-exportable. A user (with administrator or
 non-administrator system access) exists such that said 
 user desires the p and q (aka.
<a href="http://www.cem.me/20141221-cert-binaries.html">private key</a>).</p>
<p>
Or, an asymmetric key exists in the system keystore that
 is exportable by administrators only. A non-administrator
 exists that wants the key.</p>

<h5>The "Attack"</h5>
<p>
A user logs into the machine.
Open Keychain Access, select the system keystore
Select the key to export, perform a 'secondary click' (aka 'right-click') on
the key, select the export menu item.</p>
<dl>
<dt>
A prompt appears asking for a location to save the key:
<dd> Choose a place to save the key
<dt>A prompt appears to request administrator level credentials:
<dd> <i>Gently press the escape key once.</i>
<dd> The key is now exportable (if it wasn't before).
<dt>A prompt appears to set the exported key’s passphrase.
<dd> Choose to enter a password, or leave it blank. Click OK.
<dd> The user now has a pkcs#12 file complete with the private key.
</dl>

<h5>Speculation below!</h5>

<p>From what I can tell, the code would be something similar to this:</p>

<div class="snippet">
<pre>
<code>

public void exportCertFromKeychain(certID cert) {
bool exportable = true;
	// get place to store exported cert 
	// this should only happen after authorization!
	filename f = getExportLocation();
	// check if access is locked down to only allow
	//   administrators, or if it is non-exportable
	if(isProtected(cert)) {
		// get Authorization 
		int authResult = authenticateAdmin();
/* Authentication returns several different codes
0 is errAuthorizationSuccess
-60005 is errAuthorizationDenied
-60006 is errAuthorizationCanceled */
		if(authResult == 0)
			// here is the non-exportable bug
			// this should be the first thing checked..
			if(markedNonExportable(certID))
				exportable = false;
else if(authResult == -60005) // here is the admin bug
			exportable = false;
		// they should check if 'authResult' was 0,
		// and if not, set the value to false
		// when you cancel, the result is -60006
		// and 'exportable' remains true.
		
	}
// get export password
	string pass = getPassword();
	if(exportable) {
		exportCert(f, cert);
	} else {
		showError();
	}
}

</code>
</pre>
</div>


</article>



<article>
  <header>
	  <h1 class="title"><a href="20150706-pgp-art.html">PGP ASCII Art</a></h1>
	  <time class="pubdate" datetime="2015-07-06">2015-07-06</time>
  </header>

<div class="pgp">
<span class="pgp">
-----BEGIN PGP PUBLIC KEY BLOCK-----<br />
Version: GnuPG v1<br />
<br />
mQENBFWE8g8BCADWwAC1DXKsqGPZU0/OlzZvXr7waI1a15VdeocA5ILIU4IoSlne<br />
9ZLhH/38qRWyk2sS8BtaD3DbA1Izz0STuiztyVOjbKk0yjKL3pWwpaWajD5AyhvV<br />
Ln50e4s9RfyLw1OnOtCeN4G9OgR7Rrqr4JPdF09wUFgYVUWdeOmw9MGIdfTXadey<br />
sU4vTt0maghZa0wDdcnfNFK/7VWJpbqttHncWWLAkLqhirSZA6wU4GRWlNQvsYbJ<br />
BRVs+YrzewxpmBdiIjaTCeBSJPlEyLWlMw6ZPqzheSHjksuL6ElgDP5BZzYAPGCT<br />
xrVHztT2u79M1I/wpPylGaaZgg+D2coTFIAvABEBAAG2AAACt0NhcmwgTSAoLi4u<br />
</span><span class="pgpCarl">
X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
<span class="pgpArt">
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
<span class="pgpCarl">X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
</span><span class="pgp">
KSA8Y0BjZW0ubWU+iQE4BBMBAgAiBQJVhPIPAhsDBgsJCAcDAgYVCAIJCgsEFgID<br />
AQIeAQIXgAAKCRBrDTHS1xnT+4mjB/0VXjlVNflzT3qaseILatLSSAt2t1nnBGxs<br />
iJVdgIlQj2vYgb6IkmkeEsmu6avAgFktM0zM5uosx+VDxdI5v1CIUqxjWSDhOeMK<br />
Q3E9BEK/yRrehPKe3Y/NAwaVI67C393jRSuVFPoNFViNfr1ZJU8TGUYOnO2ap+9Q<br />
XlPdEXWXEyXg9luXOJl8H95XX+7b7DiStfAn3A4SXhtChDpMEkSdMD+brryB65Wh<br />
epc7BIqkQyG0w70z22KUXDPeOEdmhEY03grMBpF4MguU7bmHQgI8wFY6rFde7RXz<br />
4djsY/CILcITJcFVM0kThsMphsqLUVCvdFeK/vdZUazA3U/fnj7XuQENBFWE8g8B<br />
CADYXMKMFTfq4BNF66KvI4uAlEg+zQyMRV49IAlxXA3oCKlkxzKvsvACOfjjvPcd<br />
5DLkYA9PYZVaSWO4EU70F9chxxPA5Qkz7Y6/0wL5X3hD0fbmLtr6d0EzclhJPJ6a<br />
XAcVBsY6QZRK4ulHp1xDbGnxVbL+Gi0w0gqKSa5vI94+aP+zFdBUFvZAa9hL7ez3<br />
nm3V8H62X3Tj0Q8eCtCb3dgvDo4dRRJPOXAmydpCCZbH4EF8qI9d5Oup3FW6I8K+<br />
5Zj5OfNAwSnsp3aTIBDq2BxxN6w0CwmnBxMDjho1KwBnxDF5DAX0kJGUjAQr7EGy<br />
23SVqbXxVByWB2pGMIY1ZoozABEBAAGJAR8EGAECAAkFAlWE8g8CGwwACgkQaw0x<br />
0tcZ0/s8ZwgAunktEwPOVDTqcDn39xigdslKikqWFZGZZlp2XwIUToc+wH6qAw8h<br />
/Fc+gXT9YWc+866E3GNOuNAjY4mF/7mLorIhyVuL4lfdfxq33AKa55Bb2QpBc7iA<br />
nVt1knLWBJ9sr2SaFsGDxEfRIJ3OxcXQOCfxtSzLnaH4TnVN45yflCkhcObYVg7X<br />
1sReDDoRJmROOwi+riinSbohVRcNydx6RxaI3acH939IeGCCUUKvd87ShZjw/MxP<br />
8Z6U0qgNnXrOWtTFjLkSt0e1p1JKklc0TYkIwCaSVYeTYH/ycgEg2m/HfKMQueBY<br />
z8QGH8j84zQb4rjCI1gIwfQUbK/bmzcV7A==
<br />
=JyOF
<br />
-----END PGP PUBLIC KEY BLOCK-----
</span>
</div>

<p>While I was making the <a href="https://www.cem.me/20150621-pgp-poster.html">PGP Poster</a> I noticed that the User ID Packet, while broken apart in the UI into: Name, Email, and Comment, was in actuality just a large UTF-8 string. My imagination was spurred on by thoughts of interesting things I could do in that field, I recalled the math done by <a href="https://rya.nc/cert-tricks.html" target="_blank">Ryan Castellucci</a> allowing him to embed messages in an SSL certificate's public key. However, that only allowed for around one line of text, and the message had to be short to not affect the resultant prime. I wanted to be able to create a multiline message that would allow the creation of ASCII-style art. Of course, the User ID packet in the PGP key is ideal since you can put a large amount of arbitrary UTF-8 text inside.</p>

<p>The hardest part is translating UTF-8 into Base64 art. You cannot simply create a great piece of Base64 ASCII Art and throw it into the User ID packet because you first need valid UTF-8. </p>

<p>The translation between UTF-8 and Base64 is tricky because they are 8 and 6 bits respectively. One way to consistently take care of this problem is to find the least common multiple of 6 and 8, which is 24. Dividing 24 by 6 shows that we will have 4 Base64-character blocks to use as our <q>building blocks</q> for the ASCII Art (which if you have not figured out by now is really UTF-8 Art… but that is not as fun to say and there is really not a big difference).</p>

<p>The image below illustrates that showing UTF-8 characters translated into binary (split into 8-bits) and that binary, evenly divided into 6-bit chunks and translated into Base64.
<img src="art/utf2b64.svg" alt="utf8 to base64 translation"/></p>

<p>Next, I wrote a script that printed out all of the valid UTF-8 characters in groups of 3 as translated to the 4 characters of Base64.</p>
<pre>
<code>
#!/usr/bin/python
import base64

for x in range(33, 127) : # printable utf-8
    for y in range(33, 127) :
        for z in range(33, 127) :
            s = chr(x) + chr(y) + chr(z)
            print (base64.b64encode(s, None))
</code>
</pre>
<p>This was a bit unwieldy; rather than search through nearly a half million patterns,  I wrote some regex to map out a few of the groups of characters that I thought would make good candidates.</p>

<p>I came up with a few patterns to use; XC4r IXxX XXxX to put across the top and bottom (hint: it spells out ‘xCARLxxxxxxx’) then, to spell out CEM in the middle I used I11I and O000.</p>

<p>The next thing is to pad out the beginning of the User ID packet up to the output newline boundary. This was done by calculating the amount of characters needed and adding that many spaces to the front part of the User ID packet using my poster from the previous post.</p>

<p>Finally, start the key generation process and when it is time for the User ID input part, the default format from PGP keys is <q>&lt;Name&gt; (&lt;Comment&gt;) &lt;Email&gt;</q>. Make sure you factored the name and open parenthesis into the padding you needed, type the name and then, when asked, paste in the UTF-8 encoded Base64 ASCII art. The key generates encoding your glorious block of ASCII art. Print it out in the <a href="https://tools.ietf.org/html/rfc4880#section-6.2" target="_blank">ASCII Armor</a>'d <a href="https://tools.ietf.org/html/rfc4880#section-2.4" target="_blank">Radix-64</a> that we all know and love as a PGP Key and behold:</p>


<div class="pgp">
<span class="pgp">
-----BEGIN PGP PUBLIC KEY BLOCK-----<br />
Version: GnuPG v1<br />
<br />
mQENBFWE8g8BCADWwAC1DXKsqGPZU0/OlzZvXr7waI1a15VdeocA5ILIU4IoSlne<br />
9ZLhH/38qRWyk2sS8BtaD3DbA1Izz0STuiztyVOjbKk0yjKL3pWwpaWajD5AyhvV<br />
Ln50e4s9RfyLw1OnOtCeN4G9OgR7Rrqr4JPdF09wUFgYVUWdeOmw9MGIdfTXadey<br />
sU4vTt0maghZa0wDdcnfNFK/7VWJpbqttHncWWLAkLqhirSZA6wU4GRWlNQvsYbJ<br />
BRVs+YrzewxpmBdiIjaTCeBSJPlEyLWlMw6ZPqzheSHjksuL6ElgDP5BZzYAPGCT<br />
xrVHztT2u79M1I/wpPylGaaZgg+D2coTFIAvABEBAAG2AAACt0NhcmwgTSAoLi4u<br />
</span><span class="pgpCarl">
X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
<span class="pgpArt">
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
<span class="pgpCarl">X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
</span><span class="pgp">
KSA8Y0BjZW0ubWU+iQE4BBMBAgAiBQJVhPIPAhsDBgsJCAcDAgYVCAIJCgsEFgID<br />
AQIeAQIXgAAKCRBrDTHS1xnT+4mjB/0VXjlVNflzT3qaseILatLSSAt2t1nnBGxs<br />
iJVdgIlQj2vYgb6IkmkeEsmu6avAgFktM0zM5uosx+VDxdI5v1CIUqxjWSDhOeMK<br />
Q3E9BEK/yRrehPKe3Y/NAwaVI67C393jRSuVFPoNFViNfr1ZJU8TGUYOnO2ap+9Q<br />
XlPdEXWXEyXg9luXOJl8H95XX+7b7DiStfAn3A4SXhtChDpMEkSdMD+brryB65Wh<br />
epc7BIqkQyG0w70z22KUXDPeOEdmhEY03grMBpF4MguU7bmHQgI8wFY6rFde7RXz<br />
4djsY/CILcITJcFVM0kThsMphsqLUVCvdFeK/vdZUazA3U/fnj7XuQENBFWE8g8B<br />
CADYXMKMFTfq4BNF66KvI4uAlEg+zQyMRV49IAlxXA3oCKlkxzKvsvACOfjjvPcd<br />
5DLkYA9PYZVaSWO4EU70F9chxxPA5Qkz7Y6/0wL5X3hD0fbmLtr6d0EzclhJPJ6a<br />
XAcVBsY6QZRK4ulHp1xDbGnxVbL+Gi0w0gqKSa5vI94+aP+zFdBUFvZAa9hL7ez3<br />
nm3V8H62X3Tj0Q8eCtCb3dgvDo4dRRJPOXAmydpCCZbH4EF8qI9d5Oup3FW6I8K+<br />
5Zj5OfNAwSnsp3aTIBDq2BxxN6w0CwmnBxMDjho1KwBnxDF5DAX0kJGUjAQr7EGy<br />
23SVqbXxVByWB2pGMIY1ZoozABEBAAGJAR8EGAECAAkFAlWE8g8CGwwACgkQaw0x<br />
0tcZ0/s8ZwgAunktEwPOVDTqcDn39xigdslKikqWFZGZZlp2XwIUToc+wH6qAw8h<br />
/Fc+gXT9YWc+866E3GNOuNAjY4mF/7mLorIhyVuL4lfdfxq33AKa55Bb2QpBc7iA<br />
nVt1knLWBJ9sr2SaFsGDxEfRIJ3OxcXQOCfxtSzLnaH4TnVN45yflCkhcObYVg7X<br />
1sReDDoRJmROOwi+riinSbohVRcNydx6RxaI3acH939IeGCCUUKvd87ShZjw/MxP<br />
8Z6U0qgNnXrOWtTFjLkSt0e1p1JKklc0TYkIwCaSVYeTYH/ycgEg2m/HfKMQueBY<br />
z8QGH8j84zQb4rjCI1gIwfQUbK/bmzcV7A==
<br />
=JyOF
<br />
-----END PGP PUBLIC KEY BLOCK-----
</span>
</div>

</article>


<article>
  <header>
	  <h1 class="title"><a href="20150621-pgp-poster.html">PGP Public Key</a></h1>
	  <time class="pubdate" datetime="2015-06-21">2015-06-21</time>
  </header>
  <p>Pretty Good Privacy (PGP) has been around since 1991, it has since gained notoriety and ubiquity as one of the most popular<sup>[citation needed]</sup> person to person publication privacy programs. Now <a href="https://keybase.io/cem_">keybase.io</a> and even <a href="https://www.facebook.com/notes/protecting-the-graph/securing-email-communications-from-facebook/1611941762379302">Facebook</a> are allowing users to receive encrypted communications from their systems, whether or not that is a <a href="http://blog.cryptographyengineering.com/2014/08/whats-matter-with-pgp.html">good idea</a>.</p> 

<p>After learning about the ins and outs of <a href="https://www.cem.me/pki/index.html">certificate structures</a>, I tuned to PGP to learn how they are put together. Some of it is quite elegant, and allows the format to save space, especially in the packet headers where 2 bytes can convey essentially the same information that take 6 bytes in <a href="https://www.cem.me/20150209-cert-binaries-4.html">x.509</a>. PGP keys are made up of these packets, each packet is used to convey information about the key as a whole. By default, a key has 5 packets; Public Key (for signing), User ID (just text), Signature packet (times, algorithms, settings, and the Signature [over the Public Key, User ID, and most of the signature packet]), sub-key (for encrypting), and the sub-key signature.</p>

<p>Each header starts with a 8-bit value. The first bit is always set, the second is a switch between old and new packet styles (the new style is used for tag types represented by values larger than 4 bits, by default, keys just have old style), for the old style bits 3 through 6 indicate the <a href="https://tools.ietf.org/html/rfc4880#section-4.3">packet type</a>, the last 2 bits tell the number of length bits that immediately follow the header packet.</p>

<p>The public key packet contains the signing data and certifying other’s keys, the key for encrypting the data is the sub-key. The User ID packet is just UTF-8 data, this is normally a name, email address, and a comment from the owner (there is quite a bit of room here to store data... make sure you subscribe with <a href='http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fwww.cem.me%2Fcem.rss'>feedly</a>, or with <a href="https://www.cem.me/cem.rss">rss here</a>). The two signature packets are used to show binding between a held private key by signing the hash of the public key in the particular packet (key or sub-key), and the information specified in the signature packet. Within the signature packet, there are several <a href="https://tools.ietf.org/html/rfc4880#section-5.2.3.1">sub-packets</a> that can contain a multitude of data from signature time policy data like what the key should be used for. This data is encoded in various ways from actual integer values, to hexadecimal values denoting particular values, and binary values where each bit adds a new flag value.</p>

<p>Here is a posterized PGP key, it uses RSA keys (only 1024-bit for brevity) for both signing and encrypting and has an expiration date, the other values are just the OpenPGP defaults.</p>
<p><a href="http://www.redbubble.com/people/cem-/works/15307088-pgp-public-key?c=377869-pki-posters" target="_blank">You can get a copy printed out here</a><p>
<a href="https://dl.dropboxusercontent.com/u/25625347/PGP_Pub.png" target="_blank"><img src="https://lh3.googleusercontent.com/-JeDlyJY4fc8/VYpFna9YeMI/AAAAAAAAGwQ/_ySxho-jhwM/s800/PGP_Pub.png" alt="PGP Public Key" /></a>
</article>



<article>
  <header>
          <h1 class="title"><a href="pki/index.html">PKI Posters</a></h1>
          <time class="pubdate" datetime="2015-04-18">2015-04-18</time>
  </header>

<p>This is a series of posters and along with explanations of what they mean. They go through the entire lifecycle of an SSL certificate; from the creation of the p and q for the private key, to the signing from the certificate authority, and finally to the inclusion of the serial number in revocation structures.</p>

<p><small>
This was originally released as a series of posts. They are still available here: (<a href="https://www.cem.me/20141221-cert-binaries.html">one</a>, <a href="https://www.cem.me/20150104-cert-binaries-2.html">two</a>, <a href="https://www.cem.me/20150121-cert-binaries-3.html">three</a>, <a href="https://www.cem.me/20150209-cert-binaries-4.html">four</a>, <a href="https://www.cem.me/20150301-cert-binaries-5.html">five</a>, <a href="https://www.cem.me/20150315-cert-binaries-6.html">six</a>, and <a href="https://www.cem.me/20150401-cert-binaries-7.html">seven</a>.)</small>
</p>


<a href="pki/index.html"><img src="art/posters.png" alt="posters" /></a>

<p>If you want some high quality prints, or just want to support my work and get cool things to put on your wall you can do that <a href="https://www.redbubble.com/people/cem-/collections/377869-pki-posters">here</a> (you can get a <a href="https://www.redbubble.com/people/cem-/calendars/14447568-pki-poster-calendar">PKI Poster Calendar</a> and watch a cert throughout its lifecycle over a year).
</p>


</article>



<article>
  <header>
	  <h1 class="title"><a href="20141203-hdva.html">HTTP DANE Validation Assertion</a></h1>
	  <time class="pubdate" datetime="2014-12-03">2014-12-03</time>
  </header>


  <p>Certificates are typically authenticated via a chain of signatures that lead back to any one of a number of trusted roots. DNSSEC is validated much the same way, however, with DNSSEC there's only one root for delegating authority for the DNS while in certificates, any certificate authority can sign a certificate valid for any domain. There is a way to use this delegated system to verify connections made over TLS called DANE. In short, DANE is a way to use the DNSSEC to get signed records from an authoritative source to validate certificates used in TLS. You can see a great introduction to DANE by the working group co-chair here:<br /> <a target="_blank" href="https://www.youtube.com/watch?v=emDxUQl1NvA">https://www.youtube.com/watch?v=emDxUQl1NvA</a><br /> Also, some recent slides from a presentation by Dan York are here: <br /><a target="_blank" href="http://www.slideshare.net/Deploy360/3-dnssec-and-dane-ion-tokyo">http://www.slideshare.net/Deploy360/3-dnssec-and-dane-ion-tokyo</a>.</p>

  <p>In all things there is risk, there are ways to mitigate risk using controls, some are detective controls (CT) some are preventative (DANE, Public Key Pinning). Other's have developed many different ideas in how to ensure that the certificate that makes it to the client's browser is the one which the site owner intended. Some have done analysis of the different methods [<a target="_blank" href="https://mediatum.ub.tum.de/node?id=1182735">Ralph Holz</a>][<a target="_blank" href="http://queue.acm.org/detail.cfm?id=2668154">Ben Laurie</a>][<a target="_blank" href="http://www.scriptjunkie.us/2013/12/a-comparison-of-https-reforms/">Matt Weeks</a>]. A <a target="_blank" href="http://www.securityweek.com/convergence-replacement-throwdown-dane-vs-tack-vs-ct">SecurityWeek</a> article today even positions CT as a replacement for the preventive controls of TACK and DANE. I like certificate transparency (CT) as a way to detect CA compromise, but that is only after the fact (somthing I think that is not quite pointed out in the comparison chart at <a target="_blank" href="http://www.certificate-transparency.org/comparison">certificate-transparency.org</a> or in Ben's ACM article from above). However, for a real-time preventitive control, I prefer DANE.</p>
  <hr />
<p>Recently, I uploaded a draft to the IETF with the goal of furthering the adoption of DANE.<br />
<a target="_blank" href="https://datatracker.ietf.org/doc/draft-cem-dane-assertion/">https://datatracker.ietf.org/doc/draft-cem-dane-assertion/</a></p>
<img src="art/hdva.svg" alt="hdva" />
<p>Currently the adoption of DANE is lacking in browsers. The draft I wrote is to allow particular sites to declare themselves as ready to support DANE so that they can further lock down the security of their TLS connections. The method is to use an HTTP "Dane-Validation-Assertion" header or HDVA. I envision this as working as follows: A site sends the DVA header to a browser that tells the browser the browser will then do a lookup over DNSSEC for a TLSA (DANE) record to perform additional validations on the certificate.</p>

<p>Options for this header include the max time to keep/remember the assertion, a way to include subdomains, and a way to require a valid DANE response before continuing. The max-age and include-subdomains are used in the same manner as HTTP Strict Transport Security (<a href="https://tools.ietf.org/html/rfc6797">HSTS</a>) and HTTP Public Key Pinning (<a href="https://tools.ietf.org/html/draft-ietf-websec-key-pinning">HPKP</a>), the '<a href="http://tools.ietf.org/html/draft-cem-dane-assertion-00#section-2.1.3" target="_blank">require</a>' however, is a concept specific HDVA. The reason I included this directive was because the way DANE works; if you receive a certificate that is valid through the regular means of validating using certificate authorities (PKIX) and do not receive any DANE records, the connection will continue. By using the 'require' directive, the server operator forces the connection to be validated using the traditional method of CAs accompanied by DANE or solely by using DANE.</p>


</article>

<article>
  <header>
	  <h1 class="title"><a href="papers/cve-2014-4449.html">iOS 8.1 and CVE-2014-4449</a></h1>
	  <time class="pubdate" datetime="2014-10-20">2014-10-20</time>

  </header>
  <p>Today, Apple released security advisory <a href="http://support.apple.com/en-us/HT203119" target="_blank">APPLE-SA-2014-10-20-1</a> for iOS 8.1 that includes <a href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-4449" target="_blank">CVE-2014-4449</a>.</p>
  <p>This relates to a TLS certificate validation vulnerability in the clients accessing iCloud affecting bookmarks, calendar, tasks, and possibly other data types allowing for modification and disclosure of data.</p>
  <p>Exposure of sensitive reminders, meetings, bookmarks (including bookmarklets that could allow logins to other saved websites). Users may store sensitive data within these data objects that are synced to iCloud, these are at risk of exposure through this vulnerability.</p>
  <p><a href="papers/cve-2014-4449.html">...MORE DETAILS...</a></p>
</article>



<article>
  <header>
	  <h1 class="title"><a href="20141019-tls-quotes.html">TLS Quotes</a></h1>
	  <time class="pubdate" datetime="2014-10-19">2014-10-19</time>

  </header>
  <p>Just some completely random quotes about TLS following the POODLE vulnerability.</p>
  <blockquote><p>"Remember, everything less than TLS 1.2 with an AEAD mode is cryptographically broken."<br />
  -<a href="https://www.imperialviolet.org/2014/10/14/poodle.html" target="_blank">Adam Langley</a></p></blockquote>
  <blockquote><p>"TLS_FALLBACK_SCSV is mainly about those vulnerabilities that we *can't* list <a href="https://datatracker.ietf.org/doc/draft-ietf-tls-downgrade-scsv/" target="_blank">there</a> yet."<br />&mdash; <a href="http://www.ietf.org/mail-archive/web/tls/current/msg13926.html" target="_blank">Bodo Möller</a></p></blockquote>
</article>


<article>
  <header>
	  <h1 class="title"><a href="papers/emailcerts.html">[Not?] Misissued Certificates:</a></h1>
	  <time class="pubdate" datetime="2014-04-03">2014-04-03</time>
  <h4>or, how I was able to get over 2500 certificates for domains that I do not own</h4>

  </header>
  <p>Four years ago, in 2010, <a target="_blank" href="https://www.seifried.org/security/">Kurt Seifried</a> released <a target="_blank" href="http://www.linux-magazine.com/w3/issue/114/054-055_kurt.pdf">research</a> on how certificate authorities (CAs) validated hostnames in SSL certificate requests. <a href="https://afreak.ca/blog/author/ckeigher/" target="_blank">Colin Keigher</a> followed on by with an <a href="https://afreak.ca/blog/whos-letting-me-become-ssladmin/" target="_blank">actual implementation</a> of that research resulting in his finding of five email providers that allowed the registering of addresses, which effectively allowed him to garner certificates for those domains.</p>
  <p>I found that this avenue for procuring certificates still exists in at least two mail providers, which means that I was able to get upwards of 2,500 certificates for various domains that I do not own.</p>
  <p><a href="papers/emailcerts.html">[...READ MORE...]</a></p>
</article>


<article>
  <header>
	  <h1 class="title"><a href="papers/hpkpwn.html">Bug in Chrome security feature can fill up your hard drive &amp; crash the browser</a></h1>
	  <time class="pubdate" datetime="2014-02-20">2014-02-20</time>

  </header>
  <p>The security feature in question is one that I have <a target="_blank" href="20121201-cert-pinning.html">talked about before</a>: HTTP Public Key Pinning (<a target="_blank" href="https://tools.ietf.org/html/draft-ietf-websec-key-pinning">HPKP</a>). This feature allows a website to tell the browser only to connect to the site if it is using a particular set of SSL certificates. For example, a site can specify that the browser only use a particular CA (certificate authority) or set of CAs when communicating with its servers.</p>
  <p>On to <a target="_blank" href="https://code.google.com/p/chromium/issues/detail?id=316032">the bug</a>...</p>
  <p>Without <a target="_blank" href="https://codereview.chromium.org/86043003/">this patch</a> an evil website has the ability to fill up your hard drive, or at least up to about 16 <a target="_blank" href="http://en.wikipedia.org/wiki/Exabyte">exabytes</a>.</p>
  <p><a href="papers/hpkpwn.html">[...READ MORE...]</a></p>

</article>


<article>
  <header>
	  <h1 class="title"><a href="all.html">[...more...]</a></h1>
  </header>
</article>


<footer>
	<cite>
		<a href='http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fwww.cem.me%2Fcem.rss' class="feedly"  target='blank'><img id='feedlyFollow' src='art/fd.png' alt='follow me in feedly'></a>
		Copyright &copy; Carl Mehner</cite>
</footer>

</body>
</html>

