<?xml version="1.0"?>
<?xml-stylesheet type="text/css" href="/includes/css/rssfeed.css" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
      <atom:link href="https://www.cem.me/cem.rss" rel="self" type="application/rss+xml" />
      <title>CeM - Carl Mehner's Blog</title>
      <link>https://www.cem.me/</link>
      <image>
        <title>CeM - Carl Mehner's Blog</title>
        <url>https://www.cem.me/favicon.png</url>
        <link>https://www.cem.me/</link>
      </image>
      <description>Carl Mehner's Blog on Security, PKI, and computers</description>
      <language>en-us</language>
      <generator>by hand in vim</generator>
      <managingEditor>c+blog@cem.me (Carl Mehner)</managingEditor>
      <webMaster>c+blog@cem.me (Carl Mehner)</webMaster>

    <item>
        <title>PGP ASCII Art</title>
        <link>https://www.cem.me/20150706-pgp-art.html</link>
	<description><![CDATA[
<div class="pgp">
<span class="pgp">
-----BEGIN PGP PUBLIC KEY BLOCK-----<br />
Version: GnuPG v1<br />
<br />
mQENBFWE8g8BCADWwAC1DXKsqGPZU0/OlzZvXr7waI1a15VdeocA5ILIU4IoSlne<br />
9ZLhH/38qRWyk2sS8BtaD3DbA1Izz0STuiztyVOjbKk0yjKL3pWwpaWajD5AyhvV<br />
Ln50e4s9RfyLw1OnOtCeN4G9OgR7Rrqr4JPdF09wUFgYVUWdeOmw9MGIdfTXadey<br />
sU4vTt0maghZa0wDdcnfNFK/7VWJpbqttHncWWLAkLqhirSZA6wU4GRWlNQvsYbJ<br />
BRVs+YrzewxpmBdiIjaTCeBSJPlEyLWlMw6ZPqzheSHjksuL6ElgDP5BZzYAPGCT<br />
xrVHztT2u79M1I/wpPylGaaZgg+D2coTFIAvABEBAAG2AAACt0NhcmwgTSAoLi4u<br />
</span><span class="pgpCarl">
X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
<span class="pgpArt">
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
<span class="pgpCarl">X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
</span><span class="pgp">
KSA8Y0BjZW0ubWU+iQE4BBMBAgAiBQJVhPIPAhsDBgsJCAcDAgYVCAIJCgsEFgID<br />
AQIeAQIXgAAKCRBrDTHS1xnT+4mjB/0VXjlVNflzT3qaseILatLSSAt2t1nnBGxs<br />
iJVdgIlQj2vYgb6IkmkeEsmu6avAgFktM0zM5uosx+VDxdI5v1CIUqxjWSDhOeMK<br />
Q3E9BEK/yRrehPKe3Y/NAwaVI67C393jRSuVFPoNFViNfr1ZJU8TGUYOnO2ap+9Q<br />
XlPdEXWXEyXg9luXOJl8H95XX+7b7DiStfAn3A4SXhtChDpMEkSdMD+brryB65Wh<br />
epc7BIqkQyG0w70z22KUXDPeOEdmhEY03grMBpF4MguU7bmHQgI8wFY6rFde7RXz<br />
4djsY/CILcITJcFVM0kThsMphsqLUVCvdFeK/vdZUazA3U/fnj7XuQENBFWE8g8B<br />
CADYXMKMFTfq4BNF66KvI4uAlEg+zQyMRV49IAlxXA3oCKlkxzKvsvACOfjjvPcd<br />
5DLkYA9PYZVaSWO4EU70F9chxxPA5Qkz7Y6/0wL5X3hD0fbmLtr6d0EzclhJPJ6a<br />
XAcVBsY6QZRK4ulHp1xDbGnxVbL+Gi0w0gqKSa5vI94+aP+zFdBUFvZAa9hL7ez3<br />
nm3V8H62X3Tj0Q8eCtCb3dgvDo4dRRJPOXAmydpCCZbH4EF8qI9d5Oup3FW6I8K+<br />
5Zj5OfNAwSnsp3aTIBDq2BxxN6w0CwmnBxMDjho1KwBnxDF5DAX0kJGUjAQr7EGy<br />
23SVqbXxVByWB2pGMIY1ZoozABEBAAGJAR8EGAECAAkFAlWE8g8CGwwACgkQaw0x<br />
0tcZ0/s8ZwgAunktEwPOVDTqcDn39xigdslKikqWFZGZZlp2XwIUToc+wH6qAw8h<br />
/Fc+gXT9YWc+866E3GNOuNAjY4mF/7mLorIhyVuL4lfdfxq33AKa55Bb2QpBc7iA<br />
nVt1knLWBJ9sr2SaFsGDxEfRIJ3OxcXQOCfxtSzLnaH4TnVN45yflCkhcObYVg7X<br />
1sReDDoRJmROOwi+riinSbohVRcNydx6RxaI3acH939IeGCCUUKvd87ShZjw/MxP<br />
8Z6U0qgNnXrOWtTFjLkSt0e1p1JKklc0TYkIwCaSVYeTYH/ycgEg2m/HfKMQueBY<br />
z8QGH8j84zQb4rjCI1gIwfQUbK/bmzcV7A==
<br />
=JyOF
<br />
-----END PGP PUBLIC KEY BLOCK-----
</span>
</div>

<p>While I was making the <a href="https://www.cem.me/20150621-pgp-poster.html">PGP Poster</a> I noticed that the User ID Packet, while broken apart in the UI into: Name, Email, and Comment, was in actuality just a large UTF-8 string. My imagination was spurred on by thoughts of interesting things I could do in that field, I recalled the math done by <a href="https://rya.nc/cert-tricks.html" target="_blank">Ryan Castellucci</a> allowing him to embed messages in an SSL certificate's public key. However, that only allowed for around one line of text, and the message had to be short to not affect the resultant prime. I wanted to be able to create a multiline message that would allow the creation of ASCII-style art. Of course, the User ID packet in the PGP key is ideal since you can put a large amount of arbitrary UTF-8 text inside.</p>

<p>The hardest part is translating UTF-8 into Base64 art. You cannot simply create a great piece of Base64 ASCII Art and throw it into the User ID packet because you first need valid UTF-8. </p>

<p>The translation between UTF-8 and Base64 is tricky because they are 8 and 6 bits respectively. One way to consistently take care of this problem is to find the least common multiple of 6 and 8, which is 24. Dividing 24 by 6 shows that we will have 4 Base64-character blocks to use as our <q>building blocks</q> for the ASCII Art (which if you have not figured out by now is really UTF-8 Art… but that is not as fun to say and there is really not a big difference).</p>

<p>The image below illustrates that showing UTF-8 characters translated into binary (split into 8-bits) and that binary, evenly divided into 6-bit chunks and translated into Base64.
<img src="https://www.cem.me/art/utf2b64.svg" alt="utf8 to base64 translation"/></p>

<p>Next, I wrote a script that printed out all of the valid UTF-8 characters in groups of 3 as translated to the 4 characters of Base64.</p>
<pre>
<code>
#!/usr/bin/python
import base64

for x in range(33, 127) : # printable utf-8
    for y in range(33, 127) :
        for z in range(33, 127) :
            s = chr(x) + chr(y) + chr(z)
            print (base64.b64encode(s, None))
</code>
</pre>
<p>This was a bit unwieldy; rather than search through nearly a half million patterns,  I wrote some regex to map out a few of the groups of characters that I thought would make good candidates.</p>

<p>I came up with a few patterns to use; XC4r IXxX XXxX to put across the top and bottom (hint: it spells out ‘xCARLxxxxxxx’) then, to spell out CEM in the middle I used I11I and O000.</p>

<p>The next thing is to pad out the beginning of the User ID packet up to the output newline boundary. This was done by calculating the amount of characters needed and adding that many spaces to the front part of the User ID packet using my poster from the previous post.</p>

<p>Finally, start the key generation process and when it is time for the User ID input part, the default format from PGP keys is <q>&lt;Name&gt; (&lt;Comment&gt;) &lt;Email&gt;</q>. Make sure you factored the name and open parenthesis into the padding you needed, type the name and then, when asked, paste in the UTF-8 encoded Base64 ASCII art. The key generates encoding your glorious block of ASCII art. Print it out in the <a href="https://tools.ietf.org/html/rfc4880#section-6.2" target="_blank">ASCII Armor</a>'d <a href="https://tools.ietf.org/html/rfc4880#section-2.4" target="_blank">Radix-64</a> that we all know and love as a PGP Key and behold:</p>


<div class="pgp">
<span class="pgp">
-----BEGIN PGP PUBLIC KEY BLOCK-----<br />
Version: GnuPG v1<br />
<br />
mQENBFWE8g8BCADWwAC1DXKsqGPZU0/OlzZvXr7waI1a15VdeocA5ILIU4IoSlne<br />
9ZLhH/38qRWyk2sS8BtaD3DbA1Izz0STuiztyVOjbKk0yjKL3pWwpaWajD5AyhvV<br />
Ln50e4s9RfyLw1OnOtCeN4G9OgR7Rrqr4JPdF09wUFgYVUWdeOmw9MGIdfTXadey<br />
sU4vTt0maghZa0wDdcnfNFK/7VWJpbqttHncWWLAkLqhirSZA6wU4GRWlNQvsYbJ<br />
BRVs+YrzewxpmBdiIjaTCeBSJPlEyLWlMw6ZPqzheSHjksuL6ElgDP5BZzYAPGCT<br />
xrVHztT2u79M1I/wpPylGaaZgg+D2coTFIAvABEBAAG2AAACt0NhcmwgTSAoLi4u<br />
</span><span class="pgpCarl">
X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
<span class="pgpArt">
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000O000O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I<br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000O000O000</span><span class="pgpArt">I11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11II11I</span><span class="pgpCEM">O000</span><span class="pgpArt">I11II11I <br />
I11II11II11II11II11II11II11II11II11II11II11II11II11II11II11II11I<br />
<span class="pgpCarl">X</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXXXxXX</span><span class="pgpCEM">C4rI</span><span class="pgpCarl">XxX</span><br />
</span><span class="pgp">
KSA8Y0BjZW0ubWU+iQE4BBMBAgAiBQJVhPIPAhsDBgsJCAcDAgYVCAIJCgsEFgID<br />
AQIeAQIXgAAKCRBrDTHS1xnT+4mjB/0VXjlVNflzT3qaseILatLSSAt2t1nnBGxs<br />
iJVdgIlQj2vYgb6IkmkeEsmu6avAgFktM0zM5uosx+VDxdI5v1CIUqxjWSDhOeMK<br />
Q3E9BEK/yRrehPKe3Y/NAwaVI67C393jRSuVFPoNFViNfr1ZJU8TGUYOnO2ap+9Q<br />
XlPdEXWXEyXg9luXOJl8H95XX+7b7DiStfAn3A4SXhtChDpMEkSdMD+brryB65Wh<br />
epc7BIqkQyG0w70z22KUXDPeOEdmhEY03grMBpF4MguU7bmHQgI8wFY6rFde7RXz<br />
4djsY/CILcITJcFVM0kThsMphsqLUVCvdFeK/vdZUazA3U/fnj7XuQENBFWE8g8B<br />
CADYXMKMFTfq4BNF66KvI4uAlEg+zQyMRV49IAlxXA3oCKlkxzKvsvACOfjjvPcd<br />
5DLkYA9PYZVaSWO4EU70F9chxxPA5Qkz7Y6/0wL5X3hD0fbmLtr6d0EzclhJPJ6a<br />
XAcVBsY6QZRK4ulHp1xDbGnxVbL+Gi0w0gqKSa5vI94+aP+zFdBUFvZAa9hL7ez3<br />
nm3V8H62X3Tj0Q8eCtCb3dgvDo4dRRJPOXAmydpCCZbH4EF8qI9d5Oup3FW6I8K+<br />
5Zj5OfNAwSnsp3aTIBDq2BxxN6w0CwmnBxMDjho1KwBnxDF5DAX0kJGUjAQr7EGy<br />
23SVqbXxVByWB2pGMIY1ZoozABEBAAGJAR8EGAECAAkFAlWE8g8CGwwACgkQaw0x<br />
0tcZ0/s8ZwgAunktEwPOVDTqcDn39xigdslKikqWFZGZZlp2XwIUToc+wH6qAw8h<br />
/Fc+gXT9YWc+866E3GNOuNAjY4mF/7mLorIhyVuL4lfdfxq33AKa55Bb2QpBc7iA<br />
nVt1knLWBJ9sr2SaFsGDxEfRIJ3OxcXQOCfxtSzLnaH4TnVN45yflCkhcObYVg7X<br />
1sReDDoRJmROOwi+riinSbohVRcNydx6RxaI3acH939IeGCCUUKvd87ShZjw/MxP<br />
8Z6U0qgNnXrOWtTFjLkSt0e1p1JKklc0TYkIwCaSVYeTYH/ycgEg2m/HfKMQueBY<br />
z8QGH8j84zQb4rjCI1gIwfQUbK/bmzcV7A==
<br />
=JyOF
<br />
-----END PGP PUBLIC KEY BLOCK-----
</span>
</div>



		]]>
        </description>
        <pubDate>Mon, 06 Jul 2015 05:05:05 -0000</pubDate>
        <guid>https://www.cem.me/20150706-pgp-art.html</guid>
    </item>


   <item>
        <title>PGP Poster</title>
        <link>https://www.cem.me/20150621-pgp-poster.html?s=r</link>
	<description><![CDATA[
  <p>Pretty Good Privacy (PGP) has been around since 1991, it has since gained notoriety and ubiquity as one of the most popular<sup>[citation needed]</sup> person to person publication privacy programs. Now <a href="https://keybase.io/cem_">keybase.io</a> and even <a href="https://www.facebook.com/notes/protecting-the-graph/securing-email-communications-from-facebook/1611941762379302">Facebook</a> are allowing users to receive encrypted communications from their systems, whether or not that is a <a href="http://blog.cryptographyengineering.com/2014/08/whats-matter-with-pgp.html">good idea</a>.</p> 

<p>After learning about the ins and outs of <a href="https://www.cem.me/pki/index.html">certificate structures</a>, I tuned to PGP to learn how they are put together. Some of it is quite elegant, and allows the format to save space, especially in the packet headers where 2 bytes can convey essentially the same information that take 6 bytes in <a href="https://www.cem.me/20150209-cert-binaries-4.html">x.509</a>. PGP keys are made up of these packets, each packet is used to convey information about the key as a whole. By default, a key has 5 packets; Public Key (for signing), User ID (just text), Signature packet (times, algorithms, settings, and the Signature [over the Public Key, User ID, and most of the signature packet]), sub-key (for encrypting), and the sub-key signature.</p>

<p>Each header starts with a 8-bit value. The first bit is always set, the second is a switch between old and new packet styles (the new style is used for tag types represented by values larger than 4 bits, by default, keys just have old style), for the old style bits 3 through 6 indicate the <a href="https://tools.ietf.org/html/rfc4880#section-4.3">packet type</a>, the last 2 bits tell the number of length bits that immediately follow the header packet.</p>

<p>The public key packet contains the signing data and certifying other’s keys, the key for encrypting the data is the sub-key. The User ID packet is just UTF-8 data, this is normally a name, email address, and a comment from the owner (there is quite a bit of room here to store data... make sure you subscribe with <a href='http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fwww.cem.me%2Fcem.rss'>feedly</a>, or with <a href="https://www.cem.me/cem.rss">rss here</a>). The two signature packets are used to show binding between a held private key by signing the hash of the public key in the particular packet (key or sub-key), and the information specified in the signature packet. Within the signature packet, there are several <a href="https://tools.ietf.org/html/rfc4880#section-5.2.3.1">sub-packets</a> that can contain a multitude of data from signature time policy data like what the key should be used for. This data is encoded in various ways from actual integer values, to hexadecimal values denoting particular values, and binary values where each bit adds a new flag value.</p>

<p>Here is a posterized PGP key, it uses RSA keys (only 1024-bit for brevity) for both signing and encrypting and has an expiration date, the other values are just the OpenPGP defaults.</p>

<a href="https://dl.dropboxusercontent.com/u/25625347/PGP_Pub.png" target="_blank"><img src="https://dl.dropboxusercontent.com/u/25625347/PGP_Pub.png" alt="PGP Public Key" /></a>

         ]]>
        </description>
        <pubDate>Wed, 22 Jun 2016 02:30:30 -0000</pubDate>
        <guid>https://www.cem.me/20150621-pgp-poster.html?s=r</guid>
   </item>
   <item>
        <title>Certificate Binary Posters (Part Seven)</title>
	<link>https://www.cem.me/20150401-cert-binaries-7.html?s=r</link>
	<description><![CDATA[
<p>Certificate revocation has been done in two primary ways Certificate Revocation Lists (CRLs) and the Online Certificate Status Protocol (OCSP) at least until some browsers <a href="https://www.imperialviolet.org/2014/04/19/revchecking.html" target="_blank">stopped</a> checking for revocation. However, extended validation (EV) certificates still elicit active revocation checking by most browsers.</p>

<p>CRLs are a list of revoked certificate serial numbers from a given certificate authority. Besides the serial number, the revoked certificate list includes the timestamp of the revocation occurrence and the reason the certificate was revoked (though the reason is <a href="http://www.ccs.neu.edu/home/cbw/pdf/imc254-zhang.pdf" target="_blank">not always useful</a> in the real world). This poster has only one revoked certificate for brevity, however, if there were others they would be listed serially within the revokedCertificatesList section.</p>

<a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6132991331017780034"><img src="https://lh5.googleusercontent.com/-jCPScC-bw6I/VRzDHx_da0I/AAAAAAAAGK4/HyTzHOXaPhU/s800/crl.png" alt="CRL" /></a> 

<p>When in normal operation certificate authorities have CRL sizes that can get quite large. After <a href="http://en.wikipedia.org/wiki/Heartbleed" target="_blank">heartbleed</a> the CRL for the main CA used by CloudFlare was nearly five megabytes and used up nearly $400K worth of bandwidth. On the other hand, OCSP is much less weighty when compared to CRLs. Also, OCSP has the ability of being able to be used as a type of whitelist rather than a blacklist like CRL. An OCSP server is able to affirmatively acknowledge that a certificate is valid. With OCSP, you get a simple request and response for only the certificate you are checking rather than a large file which the validator must search through checking every serial revoked by the CA. The OCSP request is built first from the validating side by issuing a request of the OCSP server (specifying that by hashes of the CA name and key) for a particular serial.
</p>

<a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6132991323211648386"><img src="https://lh3.googleusercontent.com/-VD5-GMWzM-s/VRzDHU6VTYI/AAAAAAAAGKw/lmrvs71UrRY/s800/ocspReq.png" alt="OCSP Req" /></a> 

<p>The OCSP server will reply back with a response: good, revoked, or unknown. Alternatively, the server can return unauthenticated error codes: malformed request, internal server error, try again later, client signature required, or unauthorized. This response is split into 3 main sections, the wrapper information, the response from the server, the signature, and the chain of the OCSP responder. The server response first contains the responder subject name information, the time the response was signed, and the response. The response is made up of the information from the request, the response (good, revoked [with the time and reason code], or unknown), and the time the response is good from followed by an optional end time for the response.</p>

<a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6132991338864835394"><img src="https://lh6.googleusercontent.com/-9hNJ1Tkc7uM/VRzDIPOV-0I/AAAAAAAAGK8/HQiQb5nzKHs/s800/ocspResp.png" alt="OCSP Resp" /></a>

<p>These methods have largely been replaced by Certificate Trust Lists (CTLs) in Microsoft and CRLSets in Chrome (and soon <a href="https://blog.mozilla.org/security/2015/03/03/revoking-intermediate-certificates-introducing-onecrl/" target="_blank">OneCRL</a> in Firefox &gt;v37. However, these only typically cover emergencies or Issuer/CA certificates. The real solution is short term certificates (certificates only good for a day or two). If that is not feasible, then the solution is requiring servers to <a href="https://tools.ietf.org/html/draft-hallambaker-muststaple-00" target="_blank">staple OCSP responses</a> within the TLS handshake, forcing valid up-to-date revocation information in every connection.</p>
		]]>
        </description>
        <pubDate>Thu, 02 Apr 2015 04:40:04 -0000</pubDate>
        <guid>https://www.cem.me/20150401-cert-binaries-7.html?s=r</guid>
    </item>

   <item>
        <title>Certificate Binary Posters (Part Six)</title>
	<link>https://www.cem.me/20150315-cert-binaries-6.html?s=r</link>
	<description><![CDATA[
		<p>One thing that is <a href="https://www.cem.me/20141221-cert-binaries.html">noticeably</a>, <a href="https://www.cem.me/20150104-cert-binaries-2.html">different</a>, <a href="https://www.cem.me/20150121-cert-binaries-3.html">from</a>, <a href="https://www.cem.me/20150209-cert-binaries-4.html">previous</a>, <a href="https://www.cem.me/20150301-cert-binaries-5.html">posters</a> is that these formats are not encoded in base64, they are binary files. Most of the other files can be interpreted by cryptosystems in both binary and base64, and we typically transport them by first encoding them in base64.</p>
		<p>In these formats, in order to show the binary in a visual representation I used <a href="https://en.wikipedia.org/wiki/Netpbm_format#PGM_example">Netpbm</a> (<b>Net</b>work <b>p</b>ortable <b>b</b>itmap for<b>m</b>at) with the PGM (<b>P</b>ortable <b>G</b>ray<b>m</b>ap) format to translate the hexadecimal values into a format easier for humans to visualize. (A more fun format would be to <a href="https://gist.github.com/windytan/7910910/">use emoji</a>, but that would not fit quite as well with the rest of the poster).</p>
<img src="https://www.cem.me/art/emoji.png" alt="emoji pfx" />vs<img src="https://www.cem.me/art/pgm.png" alt="pgm jks" />
<p>Microsoft came up with the pfx format (which was later changed slightly and reworked as PKCS &#35;12), and recieved <a href="https://www.cs.auckland.ac.nz/~pgut001/pubs/pfx.html">much criticism</a> due to the complex nature, terminology, and internal formats. At first glance the p12 format seems to be fairly complex, it includes many wrappers of wrappers that enclose keys, certificates, and descriptive data. The reason for all of those is that pfx files can contain (according to Gutmann), "CRL's, keys, names, cookie recipes, dirty laundry, spare lightbulbs, and the kitchen sink". However, for storing certificates and a private key in pfx, it is really just a list of pairs of encrypted certificate chain and the associated encrypted key. </p>
<p>The keys and certificates in the pfx are stored in separate containers and encrypted with different keys and most of the time different algorithms also.</p>
<p>When using Windows, there really is no way around the algorithm used. The default is to encrypt the certificates with RC2 and the private key with 3DES, this means that the highest strength you would ever be able to achieve is equivalent to 3DES. However, on OpenSSL, you can specify the encryption algorithm for both the key and the certificates to use the stronger AES-256 by adding additional flags:<br />
<code>-certpbe AES-256-CBC -keypbe AES-256-CBC</code></p>
<p>Of course, at the moment, the strength is predominantly up to the password used as the best way to defeat even the Windows version is to use a password list. This is somewhat slowed by the number of rounds the key derivation algorithm is passed through; 2000 on pfx files generated via Windows and 2048 by default from OpenSSL.</p>

<a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6126635201442771314"><img src="https://lh6.googleusercontent.com/-rrlIl-yMdis/VQYuQWJmcXI/AAAAAAAAGGM/H2J-MCRKurM/s800/p12.png" alt="pfx"/></a>

<p>Java has its own proprietary format that it named JKS, which stands for Java KeyStore.</p> <p>While the p12 format is binary encoded ASN.1, jks format files are a strange mix of binary and ASN.1. The file begins with a "magic number" as <a href="http://en.wikipedia.org/wiki/List_of_file_signatures">many other</a> binary files do. After that comes a list of different keys or certificates. JKS files are also quite extensible and are able to hold many objects, including lists of chains, certificates, roots, as well as lone private keys. The number of keystore entries is defined at the beginning of the file and the data is listed in a serialized manner. For this example of just an x.509 certificate and key, the entry contains: a plaintext alias, encrypted private key, and plaintext chain.</p>
<p>Unlike pkcs12, you cannot choose the algorithm used to protect the keys, so everyone is stuck with a proprietary implementation of a password based key derivation scheme using MD5 to create a 3DES key. </p>

<a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6126635193771531266"><img src="https://lh6.googleusercontent.com/-eK-jRz45vyY/VQYuP5konAI/AAAAAAAAGGI/Uk5pMfTQYW0/s800/jks.png" alt="jks" /></a>

<p>The moral of the story, is use a long and complex password for either of these formats. Even so, if your keystore does get out, you will need to revoke your certificate. More on that next post.</p>

		]]>
        </description>
        <pubDate>Mon, 16 Mar 2015 03:16:16 -0000</pubDate>
        <guid>https://www.cem.me/20150315-cert-binaries-6.html</guid>
    </item>

    <item>
        <title>Certificate Binary Posters (Part Five)</title>
	<link>https://www.cem.me/20150301-cert-binaries-5.html?s=r</link>
	<description><![CDATA[
<p><small>Previous Posts: (<a href="https://www.cem.me/20141221-cert-binaries.html">Part One</a>, <a href="https://www.cem.me/20150104-cert-binaries-2.html">Part Two</a>, <a href="https://www.cem.me/20150121-cert-binaries-3.html">Part Three</a>, <a href="https://www.cem.me/20150209-cert-binaries-4.html">Part Four</a>)</small></p>
  <p>Certificates used in webservers and other end-entity uses are signed by issuers (which should not be root CAs, but it is possible). However, there are a lot of issuer certificates; in 2010 there were <a href="https://www.eff.org/files/ccc2010.pdf">nearly 1500</a>, now certainly more are out there with <a href="https://letsencrypt.org">more planned</a>. Because there are so many undistributed issuing CAs, there needs to be a way for the CA to send the issuer cert to the cert requester along with the end-entity certificate so they can pass that along to anyone that needs to validate their root. One of the common ways to pass public keys for a specific chain is the PKCS #7 format. This format is a way to ensure that the right certificates are used in the chain for the particular server certificate.</p>
  <p>PKCS #7 begins, as all the others have, with a sequence of the encoded data and length. Immediately following is the OID for PKCS #7 signedData content type. This specifies the type of the content of the p7 object. The content is put into an explicit object that contains a sequence which wraps the object. Inside, the signedData object the structure begins with a version, digest algorithm identifies (empty here), a content info (here specifying the OID for PKCS #7 data), certificates, crls (empty here), and lastly another empty field that can hold additional information on signers.<p>
  <p>The certificates field is an ASN.1 explicit type wrapper which contains x.509 sequences as they appear in the x.509 posters from <a href="https://www.cem.me/20150209-cert-binaries-4.html">part 4</a>.<p>
  <a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6108892209146183330"><img src="https://lh4.googleusercontent.com/-Mty_nrd3MaE/VMclGRFPPqI/AAAAAAAAGDs/A5j19DmJmwI/s800/PKCS7.png"  alt="p7b" /></a>
		]]>
        </description>
        <pubDate>Sun, 01 Mar 2015 06:00:00 -0000</pubDate>
        <guid>https://www.cem.me/20150301-cert-binaries-5.html</guid>
    </item>

    <item>
        <title>Certificate Binary Posters (Part Four)</title>
        <link>https://www.cem.me/20150209-cert-binaries-4.html?s=r</link>
	<description><![CDATA[

  <p><small>If you missed the previous posts, you may want to read them first (<a href="https://www.cem.me/20141221-cert-binaries.html">Part One</a>, <a href="https://www.cem.me/20150104-cert-binaries-2.html">Part Two</a>, <a href="https://www.cem.me/20150121-cert-binaries-3.html">Part Three</a>)</small></p>
  <p>After the certificate authority (CA) receives the <a href="https://www.cem.me/20150121-cert-binaries-3.html">CSR</a>, it signs it, then sends back the TLS cert. You can see two places in this certificate that directly correspond to the CSR (the public key and the DN). There are three main sections within the certificate wrapper: the tbsCertificate data (tbs = to-be-signed), the structure the specifying signature used to sign the cert, and the signature value. The CA crafts the tbsCertificate from the data given in the CSR, adding additional fields before copying the DN and SPKI (subject public key info; aka the PKCS#1 object).</p></p>The tbsCertificate starts out with a version container with a version byte, and as with all of the valid TLS certs trusted on the Internet right now, is version 3 (notice the value of 2 on the left due to the 0-based version index). Next the serial number of the cert which because this is an example is shortened, normally it will be <a href="https://cabforum.org/wp-content/uploads/BRv1.2.3.pdf">at least 20</a> random bits. The next field is byte for byte the same as the certificate's signature algorithm ID mentioned above. Following that, the name of the CA that signed the cert goes to the issuer section. The CA's DN sequence is copied to the issuer field of any certificates it signs. The CA also controls the validity dates, the UTC time elements are normally set with the start as the current time, or current GMT date at midnight, with the end date set to a max of 3 years and 3 months (or for extended validation (EV) certs 2 years and 3 months). However, they can be set to nearly any date in the future or in the past. Finally, the DN and SPKI are copied from the CSR and tacked on to the end.</p>
  <p>Up until now, all of the fields are in x.509v1 certificates, the difference between version 1 and version 3 certificates are that v3 includes the extensions section below the SPKI. Extensions allow for, as the word implies, extensibility. You can have as many or as few extensions as are required, they can be marked critical or noncritical. A critical extension must be understood by the validating software, otherwise the certificate validation must fail. There are rules set by the CA / Browser Forum for which extensions are required for inclusion and which to mark as critical. In this example, (which only follows some of the rules) there is an extension requiring the certificate to be an end-entity (that is not a CA) as well as the AKI (authority key identifier). An AKI is a way to tie a specified end-entity certificate to the certificate that issued it.</p>
  <p>Lastly, the specified signature algorithm uses the CA's private key to sign the bytes from the tbsCertificate, the result is the signature value.</p>

<a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6108892262647630978"><img src="https://lh3.googleusercontent.com/-6zdPndot6Iw/VMclJYY-jII/AAAAAAAAF-k/n9btf1nPf_A/s800/x509.png" alt="x.509 certificate" /></a>
 
		]]>
        </description>
        <pubDate>Mon, 09 Feb 2015 04:04:04 -0000</pubDate>
        <guid>https://www.cem.me/20150209-cert-binaries-4.html</guid>
    </item>


    <item>
        <title>Certificate Binary Posters (Part Three)</title>
	<link>https://www.cem.me/20150121-cert-binaries-3.html#</link>
	<description><![CDATA[
	  <p><small>If you missed the previous posts, you may want to read them first (<a href="https://www.cem.me/20141221-cert-binaries.html">Part One</a>, <a href="https://www.cem.me/20150104-cert-binaries-2.html">Part Two</a>)</small></p>  
  <p>This first part is a building block for more wonderful things to come. The Distinguished Name for x.500 are the basis for identity and trust on the Internet. You may notice that the base64 in the upper left is a certificate request, I highlighted the bytes to pull out of that to show this detailed view in order to clarify this more complex block. Each of the names in the that make up the distinguished name are an ASN.1 'set' containing a 'sequence' of the attribute type and the value of the attribute. The attribute type is an OID (Object IDentifier), a hierarchical structure used to describe namespaces. All of the OIDs here are under the x.500 attribute types namespace. Second within the set, after the OID, is the value associated to it: country, state, local, et seq. This is encoded in the UTF-8 (<b>U</b>niversal Character Set + <b>T</b>ransformation <b>F</b>ormat).</p>
  <a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6105920707666080834"><img src="https://lh4.googleusercontent.com/-gG1aAE7ovog/VLyWiHcjdEI/AAAAAAAAF8U/xzhuasDqrGQ/s800/DNx500.png" alt="x.500 - DN" /></a>
  <p>The base64 in the top left of this next poster is the same as the last, however, as the last focused on the DN, this focuses on most of the rest. I say most because the sequence immediately following the DN is a PKCS#1 object. This is the same thing I went over at the end of <a href="https://www.cem.me/20141221-cert-binaries.html">part one</a>.</p>
  <p>CSRs are sent to a certificate authority which they then use to produce a signed certificate for use in TLS to secure websites, or any number of other x.509/PKI applications.</p>
  <p>The entire CSR is contained in one large sequence. Within that is a sequence of request data followed by the CSR signature algorithm and lastly the signature value.</p>
  <p>The request data is made up of a version (value of 0, meaning of 1; <small>remember computer scientists count from 0...</small>), the DN above (which specifies the request identification information), after that is the PKCS#1 object (identical to the PKCS#1 public key poster). Lastly is the attributes section, here it is empty. The attributes are defined in a PKCS#9 objects. This field is little used now, but at one point it was used to add passwords that the requestor would have to provide at the time of revocation to authenticate to the revocation system.</p>
  <a href="https://plus.google.com/photos/+CarlMehner/albums/6105920604274654785/6105920735563250578"><img src="https://lh3.googleusercontent.com/-RAXYcgi2FuE/VLyWjvXwe5I/AAAAAAAAF8c/0zAYKNR0YY4/s800/p10.png" alt="pkcs10" /></a>
  <p>Next, what the certificate authority sends back.</p>
		]]>
        </description>
        <pubDate>Thu, 22 Jan 2015 02:30:00 +0000</pubDate>
	<guid>https://www.cem.me/20150121-cert-binaries-3.html</guid>
    </item>

    <item>
        <title>Certificate Binary Posters (Part Two)</title>
        <link>https://www.cem.me/20141221-cert-binaries-2.html?s=r</link>
	<description><![CDATA[
  <p><small>If you missed the previous post, you may want to read that first (<a href="https://www.cem.me/20141221-cert-binaries.html">Part One</a>)</small></p>
  <p>The previous post shows one way to store private keys, the PKCS#1 format. This post shows a different format, PKCS#8. This format is more extensible, allowing for more than just the one type of key to be stored. This format splits up the private key representation into three sections: a version, an algorithm identifier, and the actual private key. The version is set at 0, and may eventually change if there are any updates to the standard. The algorithm ID is an OID defined as "RSA Encryption" for use with the PKCS#1 standard. That is to say, the very same standard we went over in the previous post. The last part is a wrapper for the PKCS#1 private key object. This is the exact same thing byte for byte as the PKCS#1 private key.</p>

  <a href="https://picasaweb.google.com/lh/photo/6zamMivAFuluJ1V-6_GLW9MTjNZETYmyPJy0liipFm0?feat=embedwebsite"><img src="https://lh6.googleusercontent.com/-okA540VQO9Y/VKoiagfxR5I/AAAAAAAAF6c/19IW110wZek/s800/pkcs8nocrypt.png" alt="private key" /></a>

  <p>Unprotected private keys like that are not the best thing to keep laying around, luckily, there's another version of the PKCS#8 which holds an encrypted version of the private key. This format is broken into two pieces, an encryption algorithm and the encrypted data. The encryption algorithm starts with the algorithm identifier for the Password Based Encryption Scheme. The next section is a container for the parameters and data needed to derive the encryption key. For this example I chose to use the Password Based Encryption Scheme #2 (better known as PBKDF2). Fed into the BPKDF2 are the salt, the number of times to run the pseudorandom function over the passphrase used to encrypt the key. Next is the encryption scheme, AES-256-CBC and the initialization vector for the AES algorithm. The key resulting from the PBKDF2 and the salt are fed in as parameters to the AES function along with the message found in the encrypted data section. The result of the decryption is a BER (Basic Encoding Rules) encoded octet string. An octet string you may recognize from above (hint: it's the private key sequence).</p>

  <a href="https://picasaweb.google.com/lh/photo/UMWSoooFF6Z2LPrn7jqMQ9MTjNZETYmyPJy0liipFm0?feat=embedwebsite"><img src="https://lh4.googleusercontent.com/-KqYOjtYetuY/VBPdlSev4QI/AAAAAAAAE7Q/x507WauWmYs/s800/pkcs8encd.png" alt="encrypted private key" /></a>

  <p>Also, please note, AES is not the default algorithm for encrypting keys in openssl. The less secure, 3DES is the default, for openssl you must specify '-aes256' on the commandline to the genrsa or rsa command line applications.</p>
		]]>
        </description>
        <pubDate>Mon, 05 Jan 2015 06:00:00 +0000</pubDate>
        <guid>https://www.cem.me/20141221-cert-binaries-2.html</guid>
    </item>
      

    <item>
        <title>Certificate Binary Posters (Part One)</title>
        <link>https://www.cem.me/20141221-cert-binaries.html?s=r</link>
	<description><![CDATA[
  <p>To better understand the ins and outs of TLS certificates and the way they are stored in files, I decided to do a short series on the different PKCS (Public Key Cryptography Standards) that dissects each individual byte of the certificate or key file. This is part one which covers the public and private keys stored in the PKCS #1 format.</p>
  <p>The core and heart of a certificate are keys. Certificates utilize both public and private keys which are mathematically bound. The PKCS #1 standard includes both public and private key formats. The first step is to create the private key. Here is the way it's represented: on the top left - the binary file encoded in base64 (easiest for emailing or copy-pasting), below that - expanded into binary, and on the right - each byte expanded into what it means.</p>
  <a href="https://picasaweb.google.com/lh/photo/IBaE8vtc37W87HHgASU7l9MTjNZETYmyPJy0liipFm0?feat=embedwebsite"><img src="https://lh5.googleusercontent.com/-71toRXOy-DI/VBPdlb4knJI/AAAAAAAAE7I/r8eBViG6z7E/s800/private%2520key.png" alt="private key" /></a>
  <p>The p and q are two random primes, e is an exponent used as part of the math, the value of e is typically the same across all certs. All of the other values are calculated based off of p, q, e and specific mathematical functions. n is the result of multiplying p and q, d is equal to e<sup>-1</sup> &#37; (n - (p + q -1)), all the other formulas are noted on the chart. The calculated values are all used extensively during crypto operations and are stored in the file to make those crypto operations faster.</p>
  <p>The public key, as stored in the PKCS#1 format starts off with a wrapper of two main sections, a descriptor of the algorithm and second, the bits in the public key. The descriptor holds the OID (Object IDentifier) of the encryption algorithm for which this key is to be used. The key includes same values that may look familiar: n and e, the multiplied primes used as the modulus and the exponent the message to encrypt is raised to the power of when encrypting.</p>
  <a href="https://picasaweb.google.com/lh/photo/8gkuddZIn1OAONZx9KQzltMTjNZETYmyPJy0liipFm0?feat=embedwebsite"><img src="https://lh4.googleusercontent.com/-C40S_qivW34/VAZ_50rqpmI/AAAAAAAAE4Q/16xE0X3FsY0/s800/public%2520key.png" alt="public key" /></a>

		]]>
        </description>
        <pubDate>Sun, 21 Dec 2014 06:31:24 +0000</pubDate>
        <guid>https://www.cem.me/20141221-cert-binaries.html</guid>
    </item>

    <item>
        <title>HTTP DANE Validation Assertion</title>
        <link>https://www.cem.me/20141203-hdva.html?s=r</link>
        <description><![CDATA[
  <p>Certificates are typically authenticated via a chain of signatures that lead back to any one of a number of trusted roots. DNSSEC is validated much the same way, however, with DNSSEC there's only one root for delegating authority for the DNS while in certificates, any certificate authority can sign a certificate valid for any domain. There is a way to use this delegated system to verify connections made over TLS called DANE. In short, DANE is a way to use the DNSSEC to get signed records from an authoritative source to validate certificates used in TLS. You can see a great introduction to DANE by the working group co-chair here:<br /> <a target="_blank" href="https://www.youtube.com/watch?v=emDxUQl1NvA">https://www.youtube.com/watch?v=emDxUQl1NvA</a><br /> Also, some recent slides from a presentation by Dan York are here: <br /><a target="_blank" href="http://www.slideshare.net/Deploy360/3-dnssec-and-dane-ion-tokyo">http://www.slideshare.net/Deploy360/3-dnssec-and-dane-ion-tokyo</a>.</p>

  <p>In all things there is risk, there are ways to mitigate risk using controls, some are detective controls (CT) some are preventative (DANE, Public Key Pinning). Other's have developed many different ideas in how to ensure that the certificate that makes it to the client's browser is the one which the site owner intended. Some have done analysis of the different methods [<a target="_blank" href="https://mediatum.ub.tum.de/node?id=1182735">Ralph Holz</a>][<a target="_blank" href="http://queue.acm.org/detail.cfm?id=2668154">Ben Laurie</a>][<a target="_blank" href="http://www.scriptjunkie.us/2013/12/a-comparison-of-https-reforms/">Matt Weeks</a>]. A <a target="_blank" href="http://www.securityweek.com/convergence-replacement-throwdown-dane-vs-tack-vs-ct">SecurityWeek</a> article today even positions CT as a replacement for the preventive controls of TACK and DANE. I like certificate transparency (CT) as a way to detect CA compromise, but that is only after the fact (somthing I think that is not quite pointed out in the comparison chart at <a target="_blank" href="http://www.certificate-transparency.org/comparison">certificate-transparency.org</a> or in Ben's ACM article from above). However, for a real-time preventitive control, I prefer DANE.</p>

  <hr />
<p>Recently, I uploaded a draft to the IETF with the goal of furthering the adoption of DANE.<br />
<a target="_blank" href="https://datatracker.ietf.org/doc/draft-cem-dane-assertion/">https://datatracker.ietf.org/doc/draft-cem-dane-assertion/</a></p>

<p>Currently the adoption of DANE is lacking in browsers. The draft I wrote is to allow particular sites to declare themselves as ready to support DANE so that they can further lock down the security of their TLS connections. The method is to use an HTTP "Dane-Validation-Assertion" header or HDVA. I envision this as working as follows: A site sends the DVA header to a browser that tells the browser the browser will then do a lookup over DNSSEC for a TLSA (DANE) record to perform additional validations on the certificate.</p>

<p>Options for this header include the max time to keep/remember the assertion, a way to include subdomains, and a way to require a valid DANE response before continuing. The max-age and include-subdomains are used in the same manner as HTTP Strict Transport Security (HSTS</a>) and HTTP Public Key Pinning (HPKP</a>), the '<a href="http://tools.ietf.org/html/draft-cem-dane-assertion-00#section-2.1.3" target="_blank">require</a>' however, is a concept specific HDVA. The reason I included this directive was because the way DANE works; if you receive a certificate that is valid through the regular means of validating using certificate authorities (PKIX) and do not receive any DANE records, the connection will continue. By using the 'require' directive, the server operator forces the connection to be validated using the traditional method of CAs accompanied by DANE or solely by using DANE.</p>


	]]>
        </description>
        <pubDate>Thu, 4 Dec 2014 05:00:00 GMT</pubDate>
        <guid>https://www.cem.me/20141203-hdva.html</guid>
</item>

    <item>
        <title>iOS 8.1 and CVE-2014-4449</title>
        <link>https://www.cem.me/papers/cve-2014-4449.html?s=r</link>
        <description><![CDATA[
  <p>Today, Apple released security advisory <a href="http://support.apple.com/en-us/HT203119" target="_blank">APPLE-SA-2014-10-20-1</a> for iOS 8.1 that includes <a href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-4449" target="_blank">CVE-2014-4449</a>.</p>
  <p>This relates to a TLS certificate validation vulnerability in the clients accessing iCloud affecting bookmarks, calendar, tasks, and possibly other data types allowing for modification and disclosure of data.</p>
  <p>Exposure of sensitive reminders, meetings, bookmarks (including bookmarklets that could allow logins to other saved websites). Users may store sensitive data within these data objects that are synced to iCloud, these are at risk of exposure through this vulnerability.</p>
  <dl>
  <dt><b>Data Disclosed Includes:</b></dt>
  <dd>User Display Name</dd>
  <dd>Apple DAV Push Token</dd>
  <dd>Owner ID</dd>
  <dd>X-MobileMe-Auth Token (encoded in b64, prepended Owner ID)</dd>
  <dd>Push Key (prepended Owner ID)</dd>
  <dd>DAV Sync Token</dd>
  <dd>
   <dl>
    <dt><b>The full gziped text of the following data types:</b></dt>
    <dd>Reminders</dd>
    <dd>Calendar Events</dd>
    <dd>Safari Bookmarks</dd>
   </dl>
  </dd>
  </dl>
  
  <dl>
  <dt><b>Connections not validated include:</b></dt>
  <dd>p11-caldav.icloud.com</dd>
  <dd>p11-bookmarks.icloud.com</dd>
  </dl>
  <pre>
<code>
Vulnerability Disclosure Timeline:
==================================
2014-07-15:     Researcher discovery
2014-07-16:     Vendor Notification
2014-07-17:     Vendor Confirmation of reciept of report
2014-10-02:     Vendor Response/Feedback
2014-10-20:     Vendor Fix/Patch
2014-10-20:     Public Disclosure

Impact
==================================
CVSS Severity (version 2.0):
CVSS v2 Base Score: 6.8 (MEDIUM)
Impact Subscore: 6.4
Exploitability Subscore: 8.6
CVSS Version 2 Metrics:
Access Vector: Network exploitable
Access Complexity: Medium
Authentication: Not required to exploit
Impact Type: Allows unauthorized disclosure of
    information; Allows unauthorized modification;
    Allows disruption of service
</code>
  </pre>

  <p><i>--speculation ahead--</i><br />According to <a href="https://www.youtube.com/watch?v=cwmmLRUYaQ8" target="_blank">ElcomSoft</a>, a Russian mobile forensics company, the data gathered from the MobileMe-Auth Token might be able to be used to get additional authentication tokens as well as a number of other interesting things like iOS iCloud backups. These are encrypted using retrievable keys that are also stored in the cloud.</p>
  <p>So, assumedly, one executing an attack on CVE-2014-4449, would have the ability to not only see just the data going over the unauthenticated streams to the calendar, reminders, and bookmarks, but also could pivot those authentication keys to download and decrypt backups of iOS devices. Once a backup is retrieved and decrypted the attacker has access to all of the iPhone data using a variety of free or paid tools for forensic analysis.</p>

  ]]>
        </description>
        <pubDate>Mon, 20 Oct 2014 12:30:00 GMT</pubDate>
        <guid>https://www.cem.me/papers/cve-2014-4449.html</guid>
        </item>

   </channel>
</rss>

